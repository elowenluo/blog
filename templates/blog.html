{% extends "base.html" %}

{% block content %}
<article class="blog-container">
  <div class="content-wrapper">
    <div class="main-content">
      <header class="section-header">
        <h1>{{ section.title }}</h1>
        {% if section.description %}
          <p class="section-description">{{ section.description }}</p>
        {% endif %}
      </header>

      <section class="post-list-container">
        {% if paginator.pages %}
          <ul class="post-list">
            {% for page in paginator.pages %}
              <li class="post-item">
                <article class="post-preview">
                  <header>
                    <h2><a href="{{ page.permalink }}">{{ page.title }}</a></h2>
                    {% if page.date %}
                      <time datetime="{{ page.date }}">{{ page.date | date(format="%B %d, %Y") }}</time>
                    {% endif %}
                  </header>
                  {% if page.description %}
                    <p class="post-description">{{ page.description }}</p>
                  {% endif %}
                </article>
              </li>
            {% endfor %}
          </ul>

          <!-- Pagination controls -->
          {% if paginator.number_pagers > 1 %}
            <footer class="pagination">
              <nav aria-label="Pagination">
                <ul class="pagination-links">
                  {% if paginator.previous %}
                    <li class="page-item prev">
                      <a href="{{ paginator.previous }}" aria-label="Previous page">← Previous</a>
                    </li>
                  {% else %}
                    <li class="page-item prev disabled">
                      <span>← Previous</span>
                    </li>
                  {% endif %}
                  
                  {# Calculate the range of page numbers to display #}
                  {% set start = paginator.current_index - 2 %}
                  {% if start < 1 %}
                    {% set start = 1 %}
                  {% endif %}
                  
                  {% set end = start + 4 %}
                  {% if end > paginator.number_pagers %}
                    {% set end = paginator.number_pagers %}
                    {% set start = end - 4 %}
                    {% if start < 1 %}
                      {% set start = 1 %}
                    {% endif %}
                  {% endif %}
                  
                  {# First page and ellipsis if needed #}
                  {% if start > 1 %}
                    <li class="page-item">
                      <a href="{{ paginator.first }}">1</a>
                    </li>
                    {% if start > 2 %}
                      <li class="page-item ellipsis">
                        <span>…</span>
                      </li>
                    {% endif %}
                  {% endif %}
                  
                  {# Page number links #}
                  {% for i in range(start=start, end=end+1) %}
                    {% if i == paginator.current_index %}
                      <li class="page-item active">
                        <span aria-current="page">{{ i }}</span>
                      </li>
                    {% else %}
                      <li class="page-item">
                        <a href="{{ paginator.base_url }}{{ i }}">{{ i }}</a>
                      </li>
                    {% endif %}
                  {% endfor %}
                  
                  {# Last page and ellipsis if needed #}
                  {% if end < paginator.number_pagers %}
                    {% if end < paginator.number_pagers - 1 %}
                      <li class="page-item ellipsis">
                        <span>…</span>
                      </li>
                    {% endif %}
                    <li class="page-item">
                      <a href="{{ paginator.last }}">{{ paginator.number_pagers }}</a>
                    </li>
                  {% endif %}
                  
                  {% if paginator.next %}
                    <li class="page-item next">
                      <a href="{{ paginator.next }}" aria-label="Next page">Next →</a>
                    </li>
                  {% else %}
                    <li class="page-item next disabled">
                      <span>Next →</span>
                    </li>
                  {% endif %}
                </ul>
              </nav>
            </footer>
          {% endif %}
        {% else %}
          <p>No posts available</p>
        {% endif %}
      </section>
    </div>

    <aside class="sidebar">
      {% if section.taxonomies %}
        <section class="taxonomy-section">
          <h2>Categories</h2>
          {% if section.taxonomies.categories %}
            <ul class="taxonomy-list category-list">
              {% for category, pages in section.taxonomies.categories | sort(attribute="1", reverse=true) %}
                <li class="taxonomy-item">
                  <a href="{{ get_taxonomy_url(kind="categories", name=category) }}">
                    {{ category }} <span class="count">({{ pages | length }})</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>No categories available</p>
          {% endif %}
        </section>

        <section class="taxonomy-section">
          <h2>Tags</h2>
          {% if section.taxonomies.tags %}
            <ul class="taxonomy-list tag-cloud">
              {% for tag, pages in section.taxonomies.tags | sort(attribute="1", reverse=true) %}
                <li class="taxonomy-item tag-item">
                  <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" 
                    class="tag {% if pages | length > 10 %}tag-popular{% elif pages | length > 5 %}tag-medium{% else %}tag-small{% endif %}">
                    {{ tag }} <span class="count">({{ pages | length }})</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>No tags available</p>
          {% endif %}
        </section>
      {% endif %}
    </aside>
  </div>
</article>
{% endblock content %}